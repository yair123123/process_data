import json
import os
import toolz as t
from kafka import KafkaProducer



@t.curry
def publisher(topic,key,value):
    producer = KafkaProducer(
        bootstrap_servers=os.environ['BOOTSTRAP_SERVER'],
        value_serializer=lambda x: json.dumps(x).encode('utf-8')
    )
    chunk_json = value.to_dict(orient="records")
    producer.send(os.environ[topic], chunk_json)
    print(f"Sent Chunk to Kafka: {chunk_json}")
# Sent Chunk to Kafka: [{'eventid': 197709270002, 'year': 1977, 'month': 9, 'day': 27, 'country': 'Italy', 'city': 'Rome', 'latitude': 41.890961, 'longitude': 12.490069, 'region': 'Western Europe', 'target_type': None, 'target1': 'unk', 'target_nationality': 'Italy', 'group_name': 'Italian Social Movement (MSI)', 'group_name2': None, 'attacktype1_txt': 'Armed Assault', 'num_terrorists': nan, 'summary': None, 'num_spread': nan, 'num_killed': nan}, {'eventid': 197709270003, 'year': 1977, 'month': 9, 'day': 27, 'country': 'Colombia', 'city': 'Doncello', 'latitude': 1.68448, 'longitude': -75.28659, 'region': 'South America', 'target_type': 'Private Citizens & Property', 'target1': 'town of Doncello', 'target_nationality': 'Colombia', 'group_name': 'Revolutionary Armed Forces of Colombia (FARC)', 'group_name2': None, 'attacktype1_txt': 'Armed Assault', 'num_terrorists': 20.0, 'summary': None, 'num_spread': nan, 'num_killed': nan}, {'eventid': 197709270004, 'year': 1977, 'month': 9, 'day': 27, 'country': 'Italy', 'city': 'Trento', 'latitude': 46.066712, 'longitude': 11.119059, 'region': 'Western Europe', 'target_type': 'Business', 'target1': 'Bank', 'target_nationality': 'Italy', 'group_name': 'Red Brigades', 'group_name2': None, 'attacktype1_txt': 'Armed Assault', 'num_terrorists': 4.0, 'summary': None, 'num_spread': nan, 'num_killed': nan}, {'eventid': 197709270005, 'year': 1977, 'month': 9, 'day': 27, 'country': 'Italy', 'city': 'Trento', 'latitude': 46.066712, 'longitude': 11.119059, 'region': 'Western Europe', 'target_type': 'Business', 'target1': 'Bank', 'target_nationality': 'Italy', 'group_name': 'Red Brigades', 'group_name2': None, 'attacktype1_txt': 'Armed Assault', 'num_terrorists': nan, 'summary': None, 'num_spread': nan, 'num_killed': nan}, {'eventid': 197709280001, 'year': 1977, 'month': 9, 'day': 28, 'country': 'Spain', 'city': 'Madrid', 'latitude': 40.465595, 'longitude': -3.696263, 'region': 'Western Europe', 'target_type': 'Police', 'target1': 'Florentino Herguedas Carretero, captain', 'target_nationality': 'Spain', 'group_name': 'First of October Antifascist Resistance Group (GRAPO)', 'group_name2': None, 'attacktype1_txt': 'Assassination', 'num_terrorists': nan, 'summary': None, 'num_spread': nan, 'num_killed': nan}, {'eventid': 197709280002, 'year': 1977, 'month': 9, 'day': 28, 'country': 'Italy', 'city': 'Rome', 'latitude': 41.890961, 'longitude': 12.490069, 'region': 'Western Europe', 'target_type': None, 'target1': 'unk', 'target_nationality': 'Italy', 'group_name': 'Italian Social Movement (MSI)', 'group_name2': None, 'attacktype1_txt': 'Armed Assault', 'num_terrorists': nan, 'summary': None, 'num_spread': nan, 'num_killed': nan}, {'eventid': 197709280003, 'year': 1977, 'month': 9, 'day': 28, 'country': 'Colombia', 'city': None, 'latitude': nan, 'longitude': nan, 'region': 'South America', 'target_type': 'Utilities', 'target1': 'pipeline, Barrancabermeja', 'target_nationality': 'Colombia', 'group_name': None, 'group_name2': None, 'attacktype1_txt': 'Bombing/Explosion', 'num_terrorists': nan, 'summary': None, 'num_spread': nan, 'num_killed': nan}, {'eventid': 197709280004, 'year': 1977, 'month': 9, 'day': 28, 'country': 'India', 'city': 'Bombay', 'latitude': 19.075984, 'longitude': 72.877656, 'region': 'South Asia', 'target_type': 'Airports & Aircraft', 'target1': 'DC-8', 'target_nationality': 'Japan', 'group_name': 'Japanese Red Army (JRA)', 'group_name2': None, 'attacktype1_txt': 'Hijacking', 'num_terrorists': 5.0, 'summary': None, 'num_spread': 0.0, 'num_killed': 0.0}, {'eventid': 197709290001, 'year': 1977, 'month': 9, 'day': 29, 'country': 'Italy', 'city': 'Catanzaro', 'latitude': 38.910536, 'longitude': 16.587757, 'region': 'Western Europe', 'target_type': 'Government (General)', 'target1': 'conference office of provincial govt.', 'target_nationality': 'Italy', 'group_name': 'Communist Fighting Unit', 'group_name2': None, 'attacktype1_txt': 'Bombing/Explosion', 'num_terrorists': nan, 'summary': None, 'num_spread': nan, 'num_killed': nan}, {'eventid': 197709300001, 'year': 1977, 'month': 9, 'day': 30, 'country': 'Guatemala', 'city': 'Guatemala City', 'latitude': 14.622869, 'longitude': -90.529068, 'region': 'Central America & Caribbean', 'target_type': 'Government (General)', 'target1': 'Rafael Arriaga Bosque, former defense minister; driver', 'target_nationality': 'Guatemala', 'group_name': None, 'group_name2': None, 'attacktype1_txt': 'Assassination', 'num_terrorists': nan, 'summary': None, 'num_spread': nan, 'num_killed': nan}]
